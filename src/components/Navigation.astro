---
import { Image } from "astro:assets";
import ThemeToggle from "./ThemeToggle.astro";
import MeImage from "../assets/me.png";

const links = [
    { label: "Blog", href: "/" },
    { label: "Poetry", href: "/poetry" },
    { label: "About", href: "/about" },
];

const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, "");
const subpath = pathname.match(/[^\/]+/g);

function isActive(href: string) {
    return (
        href === pathname ||
        href === "/" + (subpath?.[0] || "") ||
        (href === "/" && subpath?.[0] === "posts")
    );
}
---

<!-- Unified Navigation Container -->
<div
    class="border-theme-accent-dark bg-background fixed top-0 left-0 z-50 flex w-full items-center justify-between p-4 md:mt-2 md:h-screen md:w-20 md:flex-col md:border-r-4 md:bg-transparent md:p-0 md:pt-2 md:pb-2"
>
    <!-- Avatar -->
    <div class="flex-shrink-0 md:flex md:justify-center">
        <a href="/">
            <Image
                src={MeImage}
                alt="Avatar"
                class="w-10 cursor-pointer md:w-15"
                loading="eager"
            />
        </a>
    </div>

    <!-- Mobile: Links grouped on right -->
    <div class="flex items-center space-x-4 md:hidden">
        {
            links.map((link) => {
                const baseClasses =
                    "sidebar-link flex items-center justify-center transition-colors text-body-lg text-[var(--color-text)]";
                const activeClasses = isActive(link.href)
                    ? "text-primary font-bold"
                    : "";
                return (
                    <a
                        href={link.href}
                        class={`${baseClasses} ${activeClasses}`}
                        aria-current={isActive(link.href) ? "page" : undefined}
                    >
                        <span>{link.label}</span>
                    </a>
                );
            })
        }
    </div>

    <!-- Desktop: Navigation Links -->
    <div
        class="hidden md:flex md:grow md:flex-col md:items-center md:justify-evenly"
    >
        {
            links.map((link) => {
                const baseClasses =
                    "sidebar-link flex items-center justify-center transition-colors md:h-20 md:-rotate-90 md:transform md:text-heading-sm text-[var(--color-text)]";
                const activeClasses = isActive(link.href)
                    ? "md:text-primary md:font-bold"
                    : "";
                return (
                    <a
                        href={link.href}
                        class={`${baseClasses} ${activeClasses}`}
                        aria-current={isActive(link.href) ? "page" : undefined}
                    >
                        <span>{link.label}</span>
                    </a>
                );
            })
        }
    </div>

    <!-- Unified Theme Toggle (mobile right, desktop bottom) -->
    <div class="flex md:mt-auto md:mb-4 md:justify-center">
        <ThemeToggle />
    </div>
</div>
