---
import { Image } from "astro:assets";
import ThemeToggle from "./ThemeToggle.astro";
import MeImage from "../assets/me.png";

const links = [
    { label: "Blog", href: "/" },
    { label: "Poetry", href: "/poetry" },
    { label: "About", href: "/about" },
];

const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, "");
const subpath = pathname.match(/[^\/]+/g);

function isActive(href: string) {
    return (
        href === pathname ||
        href === "/" + (subpath?.[0] || "") ||
        (href === "/" && subpath?.[0] === "posts")
    );
}
---

<!-- Unified Navigation Container -->
<div
    class="border-theme-accent-dark bg-theme-background fixed top-0 left-0 z-50 flex w-full items-center justify-between p-4 md:mt-2 md:h-screen md:w-20 md:flex-col md:border-r-4 md:bg-transparent md:p-0 md:pt-2 md:pb-2"
>
    <!-- Avatar -->
    <div class="flex-shrink-0 md:flex md:justify-center">
        <a href="/">
            <Image
                src={MeImage}
                alt="Avatar"
                class="w-10 cursor-pointer md:w-15"
                loading="eager"
            />
        </a>
    </div>

    <!-- Navigation Links and Theme Toggle -->
    <div class="flex items-center space-x-4 md:flex-col md:grow md:space-x-0 md:justify-evenly">
        {
            links.map((link) => {
                const baseClasses =
                    "sidebar-link flex items-center justify-center transition-colors duration-100 text-[var(--color-text)]";
                const responsiveClasses = "text-body-lg md:h-20 md:-rotate-90 md:transform md:text-heading-sm";
                const activeClasses = isActive(link.href)
                    ? "!text-primary font-bold"
                    : "";
                return (
                    <a
                        href={link.href}
                        class={`${baseClasses} ${responsiveClasses} ${activeClasses}`}
                        aria-current={isActive(link.href) ? "page" : undefined}
                    >
                        <span>{link.label}</span>
                    </a>
                );
            })
        }
        <!-- Theme Toggle: inline on mobile, absolute bottom on desktop -->
        <div class="md:absolute md:bottom-4 md:left-1/2 md:-translate-x-1/2">
            <ThemeToggle />
        </div>
    </div>
</div>
