---
import BaseLayout from "../layouts/BaseLayout.astro";
import Timeline from "../components/Timeline.astro";
import Cloudflare from "../components/logos/Cloudflare.astro";
import CodeStory from "../components/logos/CodeStory.astro";
import Setu from "../components/logos/Setu.astro";
import Intuit from "../components/logos/Intuit.astro";
import GRPC from "../components/logos/GRPC.astro";
import profileImg from "../assets/avatar.jpeg";
import { Image } from "astro:assets";
import { bio, site, workExperience } from "../content/site";

// Map logo names to components with their specific sizing
// Heights calculated from viewBox aspect ratios
const logoComponents = {
    cloudflare: {
        component: Cloudflare,
        width: 60,
        height: 20, // viewBox 101.4:33.5 â†’ 60 * (33.5/101.4) â‰ˆ 20
        class: "shrink-0 sm:h-[20px] sm:w-[60px]",
    },
    codestory: {
        component: CodeStory,
        width: 30,
        height: 30,
        class: "sm:h-[30px] sm:w-[30px]",
    },
    setu: {
        component: Setu,
        width: 48,
        height: 12, // viewBox 361.9:94 â†’ 48 * (94/361.9) â‰ˆ 12
        class: "shrink-0 sm:h-[12px] sm:w-[48px]",
    },
    intuit: {
        component: Intuit,
        width: 60,
        height: 18, // viewBox 21.845:6.509 â†’ 60 * (6.509/21.845) â‰ˆ 18
        class: "shrink-0 sm:h-[18px] sm:w-[60px]",
    },
    grpc: {
        component: GRPC,
        width: 48,
        height: 21, // viewBox 401.18:171.93 â†’ 48 * (171.93/401.18) â‰ˆ 21
        class: "shrink-0 sm:h-[21px] sm:w-[48px]",
    },
};
---

<BaseLayout title={`About ${site.title}`} description="">
    <main
        class="col-span-12 pt-4 md:col-span-10 md:col-start-2 xl:col-span-8 xl:col-start-3"
    >
        <section
            class="mx-auto grid max-w-4xl grid-cols-1 items-start gap-6 md:pt-4 lg:pt-6 xl:grid-cols-3 xl:gap-12 xl:pt-8"
        >
            <div class="order-2 xl:order-1 xl:col-span-2 xl:pr-8">
                <h2 class="text-heading-md mb-2">Hey! I am</h2>
                <h1 class="text-display-md text-primary mb-2">{site.title}</h1>
                <h3 class="text-secondary text-heading-md mb-6 lg:mb-8">
                    Welcome to my tiny space on the internet ðŸ«‚
                </h3>
                {bio.extended.map((paragraph) => (
                    <p class="text-body-lg mb-3 lg:mb-4">{paragraph}</p>
                ))}
            </div>
            <div
                class="order-1 flex justify-center xl:order-2 xl:col-span-1 xl:justify-end"
            >
                <Image
                    src={profileImg}
                    alt="Profile photo"
                    class="aspect-[16/9] w-full max-w-sm rounded-lg object-cover shadow-lg md:max-w-md lg:max-w-lg xl:aspect-auto xl:w-72 xl:max-w-none xl:object-contain"
                />
            </div>
        </section>

        <section class="mx-auto max-w-4xl pt-6">
            <div class="mb-2 flex items-center justify-between">
                <a
                    href="https://raw.githubusercontent.com/ghostwriternr/resume/refs/heads/master/naresh_resume.pdf"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-secondary text-body-lg hover:text-[var(--color-muted)]"
                >
                    View detailed resume â†—
                </a>
                <button
                    id="copy-experience"
                    class="no-select text-secondary text-body-sm flex items-center gap-1.5 transition-colors duration-150 hover:text-[var(--color-muted)]"
                    title="Copy work experience to clipboard"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"
                        ></rect>
                        <path
                            d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"
                        ></path>
                    </svg>
                    <span id="copy-experience-text">Copy</span>
                </button>
            </div>
            <Timeline class="mb-6 lg:mb-8">
                {workExperience.map((job, idx) => {
                    const logo = logoComponents[job.logo];
                    const LogoComponent = logo.component;
                    const periodDisplay = job.period.toUpperCase();
                    const needsGroupHover = job.logo === "codestory";
                    
                    return (
                        <li
                            class={`timeline-item animate-fade-in-up ${needsGroupHover ? "group" : ""}`}
                            style={`animation-delay: ${idx * 25}ms;`}
                            data-role={job.role}
                            data-company={job.company}
                            data-period={job.period}
                        >
                            <div class="flex items-start justify-between gap-3">
                                <div class="flex-1">
                                    <div class="timeline-title">
                                        <span class="block sm:inline">{job.role}</span>
                                        <span class="timeline-company hidden sm:inline sm:text-inherit">
                                            {" "}at {job.company}
                                        </span>
                                    </div>
                                    <div class="timeline-date sm:hidden">
                                        <span class="timeline-company">{job.company}</span>
                                        <span class="mx-2 text-[var(--color-subtext)]">â€¢</span>
                                        <span>{periodDisplay}</span>
                                    </div>
                                </div>
                                <div class="pt-1">
                                    <LogoComponent
                                        width={logo.width}
                                        height={logo.height}
                                        class={logo.class}
                                    />
                                </div>
                            </div>
                            <div class="timeline-date hidden sm:block">{periodDisplay}</div>
                            <p class="timeline-description">{job.description}</p>
                        </li>
                    );
                })}
            </Timeline>
        </section>
    </main>
</BaseLayout>

<script>
    const copyButton = document.getElementById("copy-experience");
    const copyText = document.getElementById("copy-experience-text");

    copyButton?.addEventListener("click", async () => {
        const timelineItems = document.querySelectorAll(".timeline-item");

        const experience = Array.from(timelineItems)
            .map((item) => {
                const role = item.getAttribute("data-role");
                const company = item.getAttribute("data-company");
                const period = item.getAttribute("data-period");
                const description = item
                    .querySelector(".timeline-description")
                    ?.textContent?.trim()
                    .replace(/\s+/g, " ");

                return `### ${role} at ${company}\n*${period}*\n\n${description}`;
            })
            .join("\n\n---\n\n");

        const fullText = `# Naresh Ramesh - Work Experience\n\n${experience}`;

        try {
            await navigator.clipboard.writeText(fullText);
            if (copyText) {
                copyText.textContent = "Copied!";
                setTimeout(() => {
                    copyText.textContent = "Copy";
                }, 2000);
            }
        } catch (err) {
            console.error("Failed to copy:", err);
        }
    });
</script>
